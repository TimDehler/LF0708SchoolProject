<!DOCTYPE html>
<html>
  <head>
    <title>PDF to Text Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
  </head>
  <body>
    <input type="file" id="pdfFile" accept=".pdf" />
    <button onclick="convertToText()">Convert to Text</button>
    <div id="output"></div>

    <script>
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js";

      function convertToText() {
        let file = document.getElementById("pdfFile").files[0];
        let fileReader = new FileReader();

        fileReader.onload = function () {
          let typedarray = new Uint8Array(this.result);
          pdfjsLib
            .getDocument({ data: typedarray })
            .promise.then(function (pdf) {
              let textContent = "";
              let totalPages = pdf.numPages;

              let loadPage = function (pageNum) {
                pdf.getPage(pageNum).then(function (page) {
                  page.getTextContent().then(function (content) {
                    let pageText = content.items
                      .map(function (item) {
                        return item.str;
                      })
                      .join(" ");
                    textContent += pageText + " ";

                    if (pageNum === totalPages) {
                      saveTextFile(textContent);
                      document.getElementById("output").textContent =
                        textContent;
                    } else {
                      loadPage(pageNum + 1);
                    }
                  });
                });
              };

              loadPage(1);
            });
        };

        fileReader.readAsArrayBuffer(file);
      }

      function saveTextFile(content) {
        let textFileBlob = new Blob([content], { type: "text/plain" });
        let fileName = "converted_text.txt";
        let downloadLink = document.createElement("a");

        downloadLink.download = fileName;
        downloadLink.href = window.URL.createObjectURL(textFileBlob);
        downloadLink.style.display = "none";
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);
      }
    </script>
  </body>
</html>
